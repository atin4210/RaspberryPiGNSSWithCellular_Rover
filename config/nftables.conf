table inet filter {
    chain input {
        type filter hook input priority 0; policy drop;

        ct state established,related accept
        iifname "lo" accept
        tcp dport 22 accept
        udp dport 53 accept

	# DHCP packets from Mosaic-X5
	iifname "usb0" udp dport 67 accept
	iifname "usb0" udp sport 67 accept
	iifname "usb0" udp dport 68 accept
	iifname "usb0" udp sport 68 accept
    }

    chain forward {
        type filter hook forward priority 0; policy drop;

        ct state established,related accept

        # Allow Mosaic-X5 (usb0) to ppp0
        iifname "usb0" oifname "ppp0" accept
        iifname "ppp0" oifname "usb0" accept

        # Allow Mosaic-X5 (usb0) to wlan0
        iifname "usb0" oifname "wlan0" accept
        iifname "wlan0" oifname "usb0" accept
    }

    chain output {
        type filter hook output priority 0; policy accept;
    }
}

table ip nat {
    chain postrouting {
        type nat hook postrouting priority 100; policy accept;

        oifname "ppp0" masquerade
        oifname "wlan0" masquerade
    }
}

